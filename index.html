<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creador de Sendas - Sistema PAPA</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --hueso: #F5F5DC;
            --menta: #98D8C8;
            --menta-oscuro: #6FB3A0;
            --menta-claro: #C1E7DD;
            --texto: #2C3E50;
            --exito: #52C78B;
            --advertencia: #F39C12;
            --error: #E74C3C;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--hueso) 0%, var(--menta-claro) 100%);
            color: var(--texto);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--hueso);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, var(--menta) 0%, var(--menta-oscuro) 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        header p {
            font-size: 1.1em;
            opacity: 0.95;
        }

        .tabs {
            display: flex;
            background: var(--menta-claro);
            border-bottom: 3px solid var(--menta);
            overflow-x: auto;
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            background: transparent;
            color: var(--texto);
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }

        .tab:hover {
            background: var(--menta);
            color: white;
        }

        .tab.active {
            background: var(--hueso);
            border-bottom-color: var(--menta-oscuro);
        }

        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--menta-oscuro);
        }

        input[type="text"],
        textarea,
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--menta-claro);
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
            background: white;
        }

        input[type="text"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--menta);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background: white;
            border: 2px solid var(--menta-claro);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checkbox-item:hover {
            border-color: var(--menta);
            background: var(--menta-claro);
        }

        .checkbox-item input[type="checkbox"],
        .checkbox-item input[type="radio"] {
            margin-right: 10px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .button {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .button-primary {
            background: var(--menta);
            color: white;
        }

        .button-primary:hover {
            background: var(--menta-oscuro);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(152, 216, 200, 0.4);
        }

        .button-secondary {
            background: white;
            color: var(--menta-oscuro);
            border: 2px solid var(--menta);
        }

        .button-secondary:hover {
            background: var(--menta-claro);
        }

        .habilidad-card {
            background: white;
            border: 2px solid var(--menta-claro);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .habilidad-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--menta-claro);
        }

        .habilidad-title {
            font-size: 1.3em;
            color: var(--menta-oscuro);
            font-weight: 700;
        }

        .presupuesto-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 15px;
            background: var(--menta-claro);
            border-radius: 20px;
            font-weight: 600;
        }

        .presupuesto-usado {
            color: var(--menta-oscuro);
        }

        .presupuesto-total {
            color: var(--texto);
        }

        .presupuesto-ok {
            background: var(--exito);
            color: white;
        }

        .presupuesto-warning {
            background: var(--advertencia);
            color: white;
        }

        .presupuesto-error {
            background: var(--error);
            color: white;
        }

        .modulo-selector {
            margin-top: 15px;
        }

        .modulo-categoria {
            margin-bottom: 15px;
        }

        .modulo-categoria-title {
            background: var(--menta);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: 600;
            margin-bottom: 10px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modulo-list {
            display: none;
            padding: 10px;
            background: var(--hueso);
            border-radius: 8px;
        }

        .modulo-list.open {
            display: block;
        }

        .modulo-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin-bottom: 8px;
            background: white;
            border: 2px solid var(--menta-claro);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modulo-item:hover {
            border-color: var(--menta);
            transform: translateX(5px);
        }

        .modulo-item.selected {
            background: var(--menta-claro);
            border-color: var(--menta-oscuro);
        }

        .modulo-nombre {
            flex: 1;
            font-weight: 500;
        }

        .modulo-coste {
            background: var(--menta);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.9em;
        }

        .modulos-seleccionados {
            margin-top: 20px;
            padding: 15px;
            background: var(--menta-claro);
            border-radius: 8px;
        }

        .modulos-seleccionados h4 {
            margin-bottom: 10px;
            color: var(--menta-oscuro);
        }

        .modulo-seleccionado {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            margin-bottom: 5px;
            background: white;
            border-radius: 6px;
        }

        .remove-modulo {
            background: var(--error);
            color: white;
            border: none;
            padding: 4px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .remove-modulo:hover {
            background: #C0392B;
        }

        .resumen {
            background: white;
            border: 3px solid var(--menta);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .resumen h3 {
            color: var(--menta-oscuro);
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .resumen-item {
            padding: 10px 0;
            border-bottom: 1px solid var(--menta-claro);
        }

        .resumen-item:last-child {
            border-bottom: none;
        }

        .resumen-label {
            font-weight: 600;
            color: var(--menta-oscuro);
            margin-bottom: 5px;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .alert-info {
            background: var(--menta-claro);
            color: var(--texto);
            border-left: 4px solid var(--menta);
        }

        .alert-warning {
            background: #FFF3CD;
            color: #856404;
            border-left: 4px solid var(--advertencia);
        }

        .alert-error {
            background: #F8D7DA;
            color: #721C24;
            border-left: 4px solid var(--error);
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }

            header h1 {
                font-size: 1.8em;
            }

            .tabs {
                flex-wrap: wrap;
            }

            .tab {
                flex: 1 1 auto;
            }
        }

        .estadisticas {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid var(--menta-claro);
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: 700;
            color: var(--menta-oscuro);
        }

        .stat-label {
            color: var(--texto);
            margin-top: 5px;
            font-size: 0.9em;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
            margin-left: 5px;
            color: var(--menta);
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: var(--texto);
            color: white;
            text-align: center;
            border-radius: 8px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9em;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .export-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üõ°Ô∏è Creador de Sendas PAPA</h1>
            <p>Sistema Modular de Dise√±o de Sendas para el Sistema PAPA</p>
        </header>

        <div class="tabs">
            <button class="tab active" onclick="openTab(event, 'paso1')">1. Concepto</button>
            <button class="tab" onclick="openTab(event, 'paso2')">2. Afinidad</button>
            <button class="tab" onclick="openTab(event, 'paso3')">3. Conceptos</button>
            <button class="tab" onclick="openTab(event, 'paso4')">4. Econom√≠a PX</button>
            <button class="tab" onclick="openTab(event, 'paso5')">5. Habilidades</button>
            <button class="tab" onclick="openTab(event, 'resumen')">üìã Resumen</button>
        </div><!-- PASO 1: CONCEPTO -->
        <div id="paso1" class="tab-content active">
            <h2 style="color: var(--menta-oscuro); margin-bottom: 20px;">Paso 1: Concepto y Fantas√≠a</h2>
            
            <div class="alert alert-info">
                <strong>üí° Consejo:</strong> Define el alma de tu Senda antes de tocar los n√∫meros. Este paso establece la identidad narrativa que guiar√° todas las decisiones mec√°nicas posteriores.
            </div>

            <div class="form-group">
                <label for="nombre-senda">Nombre de la Senda *</label>
                <input type="text" id="nombre-senda" placeholder="Ej: Senda del Caminante On√≠rico" onchange="guardarDatos()">
            </div>

            <div class="form-group">
                <label for="fantasia">Fantas√≠a Principal *
                    <span class="tooltip">‚ÑπÔ∏è
                        <span class="tooltiptext">Resume en una frase qu√© hace √∫nica a esta Senda. Esta es tu declaraci√≥n de intenci√≥n.</span>
                    </span>
                </label>
                <textarea id="fantasia" placeholder="Ej: Un guerrero que utiliza el miedo como arma, debilitando la mente de sus enemigos antes de cortar sus cuerpos." onchange="guardarDatos()"></textarea>
            </div>

            <div class="button-group" style="margin-top: 30px;">
                <button class="button button-primary" onclick="nextTab('paso2')">Siguiente: Afinidad ‚Üí</button>
            </div>
        </div>

        <!-- PASO 2: AFINIDAD -->
        <div id="paso2" class="tab-content">
            <h2 style="color: var(--menta-oscuro); margin-bottom: 20px;">Paso 2: Afinidad con las Fuerzas</h2>
            
            <div class="alert alert-info">
                <strong>üí° Consejo:</strong> Las Sendas H√≠bridas son m√°s dif√≠ciles de balancear. Se recomienda empezar con Especialista.
            </div>

            <div class="form-group">
                <label>Tipo de Senda</label>
                <div style="display: flex; gap: 20px; margin-top: 10px;">
                    <div class="checkbox-item" style="flex: 1;">
                        <input type="radio" name="tipo-senda" value="especialista" id="especialista" checked onchange="actualizarTipoSenda()">
                        <label for="especialista" style="margin: 0; cursor: pointer;">
                            <strong>Especialista</strong> (1 Energ√≠a - 6 PS Inicial)
                        </label>
                    </div>
                    <div class="checkbox-item" style="flex: 1;">
                        <input type="radio" name="tipo-senda" value="hibrido" id="hibrido" onchange="actualizarTipoSenda()">
                        <label for="hibrido" style="margin: 0; cursor: pointer;">
                            <strong>H√≠brido</strong> (2 Energ√≠as - 3 PS Inicial)
                        </label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Selecciona la(s) Energ√≠a(s) Primigenia(s) *</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="energia-destruccion" value="Destrucci√≥n" onchange="validarEnergias()">
                        <label for="energia-destruccion" style="margin: 0; cursor: pointer;">Destrucci√≥n</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="energia-conservacion" value="Conservaci√≥n" onchange="validarEnergias()">
                        <label for="energia-conservacion" style="margin: 0; cursor: pointer;">Conservaci√≥n</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="energia-transformacion" value="Transformaci√≥n" onchange="validarEnergias()">
                        <label for="energia-transformacion" style="margin: 0; cursor: pointer;">Transformaci√≥n</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="energia-creacion" value="Creaci√≥n" onchange="validarEnergias()">
                        <label for="energia-creacion" style="margin: 0; cursor: pointer;">Creaci√≥n</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="energia-caos" value="Caos" onchange="validarEnergias()">
                        <label for="energia-caos" style="margin: 0; cursor: pointer;">Caos</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="energia-orden" value="Orden" onchange="validarEnergias()">
                        <label for="energia-orden" style="margin: 0; cursor: pointer;">Orden</label>
                    </div>
                </div>
                <div id="energia-error" class="alert alert-error" style="display: none; margin-top: 10px;">
                    Selecciona el n√∫mero correcto de energ√≠as seg√∫n el tipo de Senda.
                </div>
            </div>

            <div class="button-group" style="margin-top: 30px;">
                <button class="button button-secondary" onclick="previousTab('paso1')">‚Üê Anterior</button>
                <button class="button button-primary" onclick="nextTab('paso3')">Siguiente: Conceptos ‚Üí</button>
            </div>
        </div>

        <!-- PASO 3: CONCEPTOS -->
        <div id="paso3" class="tab-content">
            <h2 style="color: var(--menta-oscuro); margin-bottom: 20px;">Paso 3: Conceptos y Equipo</h2>
            
            <div class="alert alert-info">
                <strong>üí° Consejo:</strong> El jugador que elija esta Senda seleccionar√° uno de estos tres Conceptos como su Concepto inicial.
            </div>

            <div class="form-group">
                <label>Conceptos de Senda (Selecciona 3) *</label>
                <div class="checkbox-group" id="conceptos-lista">
                    <!-- Marciales -->
                    <div class="checkbox-item">
                        <input type="checkbox" id="concepto-guerrero" value="Guerrero" onchange="validarConceptos()">
                        <label for="concepto-guerrero" style="margin: 0; cursor: pointer;">Guerrero (Marcial)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="concepto-cazador" value="Cazador" onchange="validarConceptos()">
                        <label for="concepto-cazador" style="margin: 0; cursor: pointer;">Cazador (Marcial)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="concepto-explorador" value="Explorador" onchange="validarConceptos()">
                        <label for="concepto-explorador" style="margin: 0; cursor: pointer;">Explorador (Marcial)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="concepto-monje" value="Monje" onchange="validarConceptos()">
                        <label for="concepto-monje" style="margin: 0; cursor: pointer;">Monje (Marcial)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="concepto-marinero" value="Marinero" onchange="validarConceptos()">
                        <label for="concepto-marinero" style="margin: 0; cursor: pointer;">Marinero (Marcial)</label>
                    </div>
                    <!-- Sociales -->
                    <div class="checkbox-item">
                        <input type="checkbox" id="concepto-cortesano" value="Cortesano" onchange="validarConceptos()">
                        <label for="concepto-cortesano" style="margin: 0; cursor: pointer;">Cortesano (Social)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="concepto-mercader" value="Mercader" onchange="validarConceptos()">
                        <label for="concepto-mercader" style="margin: 0; cursor: pointer;">Mercader (Social)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="concepto-picaro" value="P√≠caro" onchange="validarConceptos()">
                        <label for="concepto-picaro" style="margin: 0; cursor: pointer;">P√≠caro (Social)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="concepto-espia" value="Esp√≠a" onchange="validarConceptos()">
                        <label for="concepto-espia" style="margin: 0; cursor: pointer;">Esp√≠a (Social)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="concepto-noble" value="Noble" onchange="validarConceptos()">
                        <label for="concepto-noble" style="margin: 0; cursor: pointer;">Noble (Social)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="concepto-bardo" value="Bardo" onchange="validarConceptos()">
                        <label for="concepto-bardo" style="margin: 0; cursor: pointer;">Bardo (Social)</label>
                    </div>
                    <!-- Productivos -->
                    <div class="checkbox-item">
                        <input type="checkbox" id="concepto-herrero" value="Herrero" onchange="validarConceptos()">
                        <label for="concepto-herrero" style="margin: 0; cursor: pointer;">Herrero (Productivo)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="concepto-sastre" value="Sastre" onchange="validarConceptos()">
                        <label for="concepto-sastre" style="margin: 0; cursor: pointer;">Sastre (Productivo)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="concepto-alquimista" value="Alquimista" onchange="validarConceptos()">
                        <label for="concepto-alquimista" style="margin: 0; cursor: pointer;">Alquimista (Productivo)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="concepto-carpintero" value="Carpintero" onchange="validarConceptos()">
                        <label for="concepto-carpintero" style="margin: 0; cursor: pointer;">Carpintero (Productivo)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="concepto-agricultor" value="Agricultor" onchange="validarConceptos()">
                        <label for="concepto-agricultor" style="margin: 0; cursor: pointer;">Agricultor (Productivo)</label>
                    </div>
                    <!-- Espirituales -->
                    <div class="checkbox-item">
                        <input type="checkbox" id="concepto-hechicero" value="Hechicero" onchange="validarConceptos()">
                        <label for="concepto-hechicero" style="margin: 0; cursor: pointer;">Hechicero (Espiritual)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="concepto-sacerdote" value="Sacerdote" onchange="validarConceptos()">
                        <label for="concepto-sacerdote" style="margin: 0; cursor: pointer;">Sacerdote (Espiritual)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="concepto-espiritista" value="Espiritista" onchange="validarConceptos()">
                        <label for="concepto-espiritista" style="margin: 0; cursor: pointer;">Espiritista (Espiritual)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="concepto-curandero" value="Curandero" onchange="validarConceptos()">
                        <label for="concepto-curandero" style="margin: 0; cursor: pointer;">Curandero (Espiritual)</label>
                    </div>
                    <!-- Intelectuales -->
                    <div class="checkbox-item">
                        <input type="checkbox" id="concepto-erudito" value="Erudito" onchange="validarConceptos()">
                        <label for="concepto-erudito" style="margin: 0; cursor: pointer;">Erudito (Intelectual)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="concepto-ingeniero" value="Ingeniero" onchange="validarConceptos()">
                        <label for="concepto-ingeniero" style="margin: 0; cursor: pointer;">Ingeniero (Intelectual)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="concepto-historiador" value="Historiador" onchange="validarConceptos()">
                        <label for="concepto-historiador" style="margin: 0; cursor: pointer;">Historiador (Intelectual)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="concepto-filosofo" value="Fil√≥sofo" onchange="validarConceptos()">
                        <label for="concepto-filosofo" style="margin: 0; cursor: pointer;">Fil√≥sofo (Intelectual)</label>
                    </div>
                </div>
                <div id="conceptos-error" class="alert alert-error" style="display: none; margin-top: 10px;">
                    Debes seleccionar exactamente 3 conceptos.
                </div>
            </div>

            <div class="form-group">
                <label for="equipo">Equipo Inicial *
                    <span class="tooltip">‚ÑπÔ∏è
                        <span class="tooltiptext">Define un paquete de equipo b√°sico valorado en 100-150 Lectos. Debe ser funcional pero no excepcional.</span>
                    </span>
                </label>
                <textarea id="equipo" placeholder="Ej: Arma marcial (martillo de guerra), Armadura media, Kit de herramientas (martillos, palancas, cinceles)" onchange="guardarDatos()"></textarea>
            </div>

            <div class="button-group" style="margin-top: 30px;">
                <button class="button button-secondary" onclick="previousTab('paso2')">‚Üê Anterior</button>
                <button class="button button-primary" onclick="nextTab('paso4')">Siguiente: Econom√≠a ‚Üí</button>
            </div>
        </div>

        <!-- PASO 4: ECONOM√çA PX -->
        <div id="paso4" class="tab-content">
            <h2 style="color: var(--menta-oscuro); margin-bottom: 20px;">Paso 4: Econom√≠a de Experiencia</h2>
            
            <div class="alert alert-info">
                <strong>üí° Consejo:</strong> Elige 3 categor√≠as que la Senda aprende m√°s r√°pido (Afines x0.8) y 2 que aprende m√°s lento (Ajenas x1.5).
            </div>

            <div class="grid-2">
                <div>
                    <h3 style="color: var(--menta-oscuro); margin-bottom: 15px;">Categor√≠as Afines (3)
                        <span class="tooltip">‚ÑπÔ∏è
                            <span class="tooltiptext">Representa aquello que la Senda domina naturalmente. Coste reducido al 80%.</span>
                        </span>
                    </h3>
                    <div class="checkbox-group" id="afines-lista">
                        <div class="checkbox-item">
                            <input type="checkbox" value="Atributo: Cuerpo" onchange="validarEconomia('afin')">
                            <label style="margin: 0; cursor: pointer;">Atributo: Cuerpo</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" value="Atributo: Destreza" onchange="validarEconomia('afin')">
                            <label style="margin: 0; cursor: pointer;">Atributo: Destreza</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" value="Atributo: Aura" onchange="validarEconomia('afin')">
                            <label style="margin: 0; cursor: pointer;">Atributo: Aura</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" value="Potenciar Naturalezas" onchange="validarEconomia('afin')">
                            <label style="margin: 0; cursor: pointer;">Potenciar Naturalezas</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" value="Potenciar Conceptos" onchange="validarEconomia('afin')">
                            <label style="margin: 0; cursor: pointer;">Potenciar Conceptos</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" value="T√©cnicas de Destrucci√≥n" onchange="validarEconomia('afin')">
                            <label style="margin: 0; cursor: pointer;">T√©cnicas: Destrucci√≥n</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" value="T√©cnicas de Conservaci√≥n" onchange="validarEconomia('afin')">
                            <label style="margin: 0; cursor: pointer;">T√©cnicas: Conservaci√≥n</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" value="T√©cnicas de Transformaci√≥n" onchange="validarEconomia('afin')">
                            <label style="margin: 0; cursor: pointer;">T√©cnicas: Transformaci√≥n</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" value="T√©cnicas de Creaci√≥n" onchange="validarEconomia('afin')">
                            <label style="margin: 0; cursor: pointer;">T√©cnicas: Creaci√≥n</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" value="T√©cnicas de Caos" onchange="validarEconomia('afin')">
                            <label style="margin: 0; cursor: pointer;">T√©cnicas: Caos</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" value="T√©cnicas de Orden" onchange="validarEconomia('afin')">
                            <label style="margin: 0; cursor: pointer;">T√©cnicas: Orden</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" value="Conceptos Marciales" onchange="validarEconomia('afin')">
                            <label style="margin: 0; cursor: pointer;">Conceptos Marciales</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" value="Conceptos Sociales" onchange="validarEconomia('afin')">
                            <label style="margin: 0; cursor: pointer;">Conceptos Sociales</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" value="Conceptos Espirituales" onchange="validarEconomia('afin')">
                            <label style="margin: 0; cursor: pointer;">Conceptos Espirituales</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" value="Conceptos Intelectuales" onchange="validarEconomia('afin')">
                            <label style="margin: 0; cursor: pointer;">Conceptos Intelectuales</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" value="Conceptos Productivos" onchange="validarEconomia('afin')">
                            <label style="margin: 0; cursor: pointer;">Conceptos Productivos</label>
                        </div>
                    </div>
                    <div id="afines-error" class="alert alert-error" style="display: none; margin-top: 10px;">
                        Debes seleccionar exactamente 3 categor√≠as afines.
                    </div>
                </div>

                <div>
                    <h3 style="color: var(--menta-oscuro); margin-bottom: 15px;">Categor√≠as Ajenas (2)
                        <span class="tooltip">‚ÑπÔ∏è
                            <span class="tooltiptext">Representa aquello alejado del enfoque de la Senda. Coste aumentado al 150%.</span>
                        </span>
                    </h3>
                    <div class="checkbox-group" id="ajenas-lista">
                        <div class="checkbox-item">
                            <input type="checkbox" value="Atributo: Cuerpo" onchange="validarEconomia('ajeno')">
                            <label style="margin: 0; cursor: pointer;">Atributo: Cuerpo</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" value="Atributo: Destreza" onchange="validarEconomia('ajeno')">
                            <label style="margin: 0; cursor: pointer;">Atributo: Destreza</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" value="Atributo: Aura" onchange="validarEconomia('ajeno')">
                            <label style="margin: 0; cursor: pointer;">Atributo: Aura</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" value="Potenciar Naturalezas" onchange="validarEconomia('ajeno')">
                            <label style="margin: 0; cursor: pointer;">Potenciar Naturalezas</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" value="Potenciar Conceptos" onchange="validarEconomia('ajeno')">
                            <label style="margin: 0; cursor: pointer;">Potenciar Conceptos</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" value="T√©cnicas de Destrucci√≥n" onchange="validarEconomia('ajeno')">
                            <label style="margin: 0; cursor: pointer;">T√©cnicas: Destrucci√≥n</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" value="T√©cnicas de Conservaci√≥n" onchange="validarEconomia('ajeno')">
                            <label style="margin: 0; cursor: pointer;">T√©cnicas: Conservaci√≥n</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" value="T√©cnicas de Transformaci√≥n" onchange="validarEconomia('ajeno')">
                            <label style="margin: 0; cursor: pointer;">T√©cnicas: Transformaci√≥n</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" value="T√©cnicas de Creaci√≥n" onchange="validarEconomia('ajeno')">
                            <label style="margin: 0; cursor: pointer;">T√©cnicas: Creaci√≥n</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" value="T√©cnicas de Caos" onchange="validarEconomia('ajeno')">
                            <label style="margin: 0; cursor: pointer;">T√©cnicas: Caos</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" value="T√©cnicas de Orden" onchange="validarEconomia('ajeno')">
                            <label style="margin: 0; cursor: pointer;">T√©cnicas: Orden</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" value="Conceptos Marciales" onchange="validarEconomia('ajeno')">
                            <label style="margin: 0; cursor: pointer;">Conceptos Marciales</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" value="Conceptos Sociales" onchange="validarEconomia('ajeno')">
                            <label style="margin: 0; cursor: pointer;">Conceptos Sociales</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" value="Conceptos Espirituales" onchange="validarEconomia('ajeno')">
                            <label style="margin: 0; cursor: pointer;">Conceptos Espirituales</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" value="Conceptos Intelectuales" onchange="validarEconomia('ajeno')">
                            <label style="margin: 0; cursor: pointer;">Conceptos Intelectuales</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" value="Conceptos Productivos" onchange="validarEconomia('ajeno')">
                            <label style="margin: 0; cursor: pointer;">Conceptos Productivos</label>
                        </div>
                    </div>
                    <div id="ajenas-error" class="alert alert-error" style="display: none; margin-top: 10px;">
                        Debes seleccionar exactamente 2 categor√≠as ajenas.
                    </div>
                </div>
            </div>

            <div class="button-group" style="margin-top: 30px;">
                <button class="button button-secondary" onclick="previousTab('paso3')">‚Üê Anterior</button>
                <button class="button button-primary" onclick="nextTab('paso5')">Siguiente: Habilidades ‚Üí</button>
            </div>
        </div>

        <!-- PASO 5: HABILIDADES -->
        <div id="paso5" class="tab-content">
            <h2 style="color: var(--menta-oscuro); margin-bottom: 20px;">Paso 5: Dise√±o de Habilidades</h2>
            
            <div class="alert alert-info">
                <strong>üí° Consejo:</strong> Construye cada habilidad combinando m√≥dulos del cat√°logo. El presupuesto de PS var√≠a seg√∫n el nivel.
            </div>

            <div class="estadisticas">
                <div class="stat-card">
                    <div class="stat-value" id="total-ps-usado">0</div>
                    <div class="stat-label">PS Totales Usados</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-ps-disponible">38</div>
                    <div class="stat-label">PS Disponibles</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="habilidades-completas">0/7</div>
                    <div class="stat-label">Habilidades Completas</div>
                </div>
            </div>

            <!-- Habilidad Inicial -->
            <div class="habilidad-card" id="hab-inicial">
                <div class="habilidad-header">
                    <div class="habilidad-title">Habilidad Inicial</div>
                    <div class="presupuesto-indicator" id="presupuesto-inicial">
                        <span class="presupuesto-usado">0</span> / <span class="presupuesto-total">6 PS</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Nombre de la Habilidad</label>
                    <input type="text" id="nombre-inicial" placeholder="Ej: Rompe Estructuras" onchange="guardarHabilidad('inicial')">
                </div>

                <div class="form-group">
                    <label>Descripci√≥n Narrativa</label>
                    <textarea id="desc-inicial" placeholder="Describe c√≥mo se ve y se siente esta habilidad en el mundo del juego..." onchange="guardarHabilidad('inicial')"></textarea>
                </div>

                <button class="button button-primary" onclick="abrirSelectorModulos('inicial', 6)">
                    ‚ûï A√±adir M√≥dulos
                </button>

                <div class="modulos-seleccionados" id="modulos-inicial" style="display: none;">
                    <h4>M√≥dulos Seleccionados:</h4>
                    <div id="lista-modulos-inicial"></div>
                </div>
            </div>

            <!-- Rango 1A -->
            <div class="habilidad-card" id="hab-rango1a">
                <div class="habilidad-header">
                    <div class="habilidad-title">Rango 1A</div>
                    <div class="presupuesto-indicator" id="presupuesto-rango1a">
                        <span class="presupuesto-usado">0</span> / <span class="presupuesto-total">4 PS</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Nombre de la Habilidad</label>
                    <input type="text" id="nombre-rango1a" placeholder="Ej: Golpe Demoledor" onchange="guardarHabilidad('rango1a')">
                </div>

                <div class="form-group">
                    <label>Tipo de Acci√≥n</label><select id="tipo-rango1a" onchange="guardarHabilidad('rango1a')">
                    <option value="">Selecciona...</option>
                    <option value="Pasiva">Pasiva</option>
                    <option value="Acci√≥n R√°pida">Acci√≥n R√°pida (4 Resistencia)</option>
                    <option value="Acci√≥n Principal">Acci√≥n Principal (2 Resistencia)</option>
                    <option value="Acci√≥n Completa">Acci√≥n Completa (0 Resistencia)</option>
                    <option value="Reacci√≥n">Reacci√≥n</option>
                </select>
            </div>

            <div class="form-group">
                <label>Descripci√≥n Narrativa</label>
                <textarea id="desc-rango1a" onchange="guardarHabilidad('rango1a')"></textarea>
            </div>

            <button class="button button-primary" onclick="abrirSelectorModulos('rango1a', 4)">
                ‚ûï A√±adir M√≥dulos
            </button>

            <div class="modulos-seleccionados" id="modulos-rango1a" style="display: none;">
                <h4>M√≥dulos Seleccionados:</h4>
                <div id="lista-modulos-rango1a"></div>
            </div>
        </div>

        <!-- Rango 1B -->
        <div class="habilidad-card" id="hab-rango1b">
            <div class="habilidad-header">
                <div class="habilidad-title">Rango 1B</div>
                <div class="presupuesto-indicator" id="presupuesto-rango1b">
                    <span class="presupuesto-usado">0</span> / <span class="presupuesto-total">4 PS</span>
                </div>
            </div>
            
            <div class="form-group">
                <label>Nombre de la Habilidad</label>
                <input type="text" id="nombre-rango1b" onchange="guardarHabilidad('rango1b')">
            </div>

            <div class="form-group">
                <label>Tipo de Acci√≥n</label>
                <select id="tipo-rango1b" onchange="guardarHabilidad('rango1b')">
                    <option value="">Selecciona...</option>
                    <option value="Pasiva">Pasiva</option>
                    <option value="Acci√≥n R√°pida">Acci√≥n R√°pida (4 Resistencia)</option>
                    <option value="Acci√≥n Principal">Acci√≥n Principal (2 Resistencia)</option>
                    <option value="Acci√≥n Completa">Acci√≥n Completa (0 Resistencia)</option>
                    <option value="Reacci√≥n">Reacci√≥n</option>
                </select>
            </div>

            <div class="form-group">
                <label>Descripci√≥n Narrativa</label>
                <textarea id="desc-rango1b" onchange="guardarHabilidad('rango1b')"></textarea>
            </div>

            <button class="button button-primary" onclick="abrirSelectorModulos('rango1b', 4)">
                ‚ûï A√±adir M√≥dulos
            </button>

            <div class="modulos-seleccionados" id="modulos-rango1b" style="display: none;">
                <h4>M√≥dulos Seleccionados:</h4>
                <div id="lista-modulos-rango1b"></div>
            </div>
        </div>

        <!-- Rango 2A -->
        <div class="habilidad-card" id="hab-rango2a">
            <div class="habilidad-header">
                <div class="habilidad-title">Rango 2A</div>
                <div class="presupuesto-indicator" id="presupuesto-rango2a">
                    <span class="presupuesto-usado">0</span> / <span class="presupuesto-total">6 PS</span>
                </div>
            </div>
            
            <div class="form-group">
                <label>Nombre de la Habilidad</label>
                <input type="text" id="nombre-rango2a" onchange="guardarHabilidad('rango2a')">
            </div>

            <div class="form-group">
                <label>Tipo de Acci√≥n</label>
                <select id="tipo-rango2a" onchange="guardarHabilidad('rango2a')">
                    <option value="">Selecciona...</option>
                    <option value="Pasiva">Pasiva</option>
                    <option value="Acci√≥n R√°pida">Acci√≥n R√°pida (4 Resistencia)</option>
                    <option value="Acci√≥n Principal">Acci√≥n Principal (2 Resistencia)</option>
                    <option value="Acci√≥n Completa">Acci√≥n Completa (0 Resistencia)</option>
                    <option value="Reacci√≥n">Reacci√≥n</option>
                </select>
            </div>

            <div class="form-group">
                <label>Descripci√≥n Narrativa</label>
                <textarea id="desc-rango2a" onchange="guardarHabilidad('rango2a')"></textarea>
            </div>

            <button class="button button-primary" onclick="abrirSelectorModulos('rango2a', 6)">
                ‚ûï A√±adir M√≥dulos
            </button>

            <div class="modulos-seleccionados" id="modulos-rango2a" style="display: none;">
                <h4>M√≥dulos Seleccionados:</h4>
                <div id="lista-modulos-rango2a"></div>
            </div>
        </div>

        <!-- Rango 2B -->
        <div class="habilidad-card" id="hab-rango2b">
            <div class="habilidad-header">
                <div class="habilidad-title">Rango 2B</div>
                <div class="presupuesto-indicator" id="presupuesto-rango2b">
                    <span class="presupuesto-usado">0</span> / <span class="presupuesto-total">6 PS</span>
                </div>
            </div>
            
            <div class="form-group">
                <label>Nombre de la Habilidad</label>
                <input type="text" id="nombre-rango2b" onchange="guardarHabilidad('rango2b')">
            </div>

            <div class="form-group">
                <label>Tipo de Acci√≥n</label>
                <select id="tipo-rango2b" onchange="guardarHabilidad('rango2b')">
                    <option value="">Selecciona...</option>
                    <option value="Pasiva">Pasiva</option>
                    <option value="Acci√≥n R√°pida">Acci√≥n R√°pida (4 Resistencia)</option>
                    <option value="Acci√≥n Principal">Acci√≥n Principal (2 Resistencia)</option>
                    <option value="Acci√≥n Completa">Acci√≥n Completa (0 Resistencia)</option>
                    <option value="Reacci√≥n">Reacci√≥n</option>
                </select>
            </div>

            <div class="form-group">
                <label>Descripci√≥n Narrativa</label>
                <textarea id="desc-rango2b" onchange="guardarHabilidad('rango2b')"></textarea>
            </div>

            <button class="button button-primary" onclick="abrirSelectorModulos('rango2b', 6)">
                ‚ûï A√±adir M√≥dulos
            </button>

            <div class="modulos-seleccionados" id="modulos-rango2b" style="display: none;">
                <h4>M√≥dulos Seleccionados:</h4>
                <div id="lista-modulos-rango2b"></div>
            </div>
        </div>

        <!-- Rango 3A -->
        <div class="habilidad-card" id="hab-rango3a">
            <div class="habilidad-header">
                <div class="habilidad-title">Rango 3A</div>
                <div class="presupuesto-indicator" id="presupuesto-rango3a">
                    <span class="presupuesto-usado">0</span> / <span class="presupuesto-total">9 PS</span>
                </div>
            </div>
            
            <div class="form-group">
                <label>Nombre de la Habilidad</label>
                <input type="text" id="nombre-rango3a" onchange="guardarHabilidad('rango3a')">
            </div>

            <div class="form-group">
                <label>Tipo de Acci√≥n</label>
                <select id="tipo-rango3a" onchange="guardarHabilidad('rango3a')">
                    <option value="">Selecciona...</option>
                    <option value="Pasiva">Pasiva</option>
                    <option value="Acci√≥n R√°pida">Acci√≥n R√°pida (4 Resistencia)</option>
                    <option value="Acci√≥n Principal">Acci√≥n Principal (2 Resistencia)</option>
                    <option value="Acci√≥n Completa">Acci√≥n Completa (0 Resistencia)</option>
                    <option value="Reacci√≥n">Reacci√≥n</option>
                </select>
            </div>

            <div class="form-group">
                <label>Descripci√≥n Narrativa</label>
                <textarea id="desc-rango3a" onchange="guardarHabilidad('rango3a')"></textarea>
            </div>

            <button class="button button-primary" onclick="abrirSelectorModulos('rango3a', 9)">
                ‚ûï A√±adir M√≥dulos
            </button>

            <div class="modulos-seleccionados" id="modulos-rango3a" style="display: none;">
                <h4>M√≥dulos Seleccionados:</h4>
                <div id="lista-modulos-rango3a"></div>
            </div>
        </div>

        <!-- Rango 3B -->
        <div class="habilidad-card" id="hab-rango3b">
            <div class="habilidad-header">
                <div class="habilidad-title">Rango 3B</div>
                <div class="presupuesto-indicator" id="presupuesto-rango3b">
                    <span class="presupuesto-usado">0</span> / <span class="presupuesto-total">9 PS</span>
                </div>
            </div>
            
            <div class="form-group">
                <label>Nombre de la Habilidad</label>
                <input type="text" id="nombre-rango3b" onchange="guardarHabilidad('rango3b')">
            </div>

            <div class="form-group">
                <label>Tipo de Acci√≥n</label>
                <select id="tipo-rango3b" onchange="guardarHabilidad('rango3b')">
                    <option value="">Selecciona...</option>
                    <option value="Pasiva">Pasiva</option>
                    <option value="Acci√≥n R√°pida">Acci√≥n R√°pida (4 Resistencia)</option>
                    <option value="Acci√≥n Principal">Acci√≥n Principal (2 Resistencia)</option>
                    <option value="Acci√≥n Completa">Acci√≥n Completa (0 Resistencia)</option>
                    <option value="Reacci√≥n">Reacci√≥n</option>
                </select>
            </div>

            <div class="form-group">
                <label>Descripci√≥n Narrativa</label>
                <textarea id="desc-rango3b" onchange="guardarHabilidad('rango3b')"></textarea>
            </div>

            <button class="button button-primary" onclick="abrirSelectorModulos('rango3b', 9)">
                ‚ûï A√±adir M√≥dulos
            </button>

            <div class="modulos-seleccionados" id="modulos-rango3b" style="display: none;">
                <h4>M√≥dulos Seleccionados:</h4>
                <div id="lista-modulos-rango3b"></div>
            </div>
        </div>

        <div class="button-group" style="margin-top: 30px;">
            <button class="button button-secondary" onclick="previousTab('paso4')">‚Üê Anterior</button>
            <button class="button button-primary" onclick="nextTab('resumen')">Ver Resumen ‚Üí</button>
        </div>
    </div>

    <!-- RESUMEN -->
    <div id="resumen" class="tab-content">
        <h2 style="color: var(--menta-oscuro); margin-bottom: 20px;">üìã Resumen de la Senda</h2>
        
        <div id="validacion-resumen"></div>

        <div class="resumen" id="resumen-completo">
            <!-- El resumen se generar√° din√°micamente con JavaScript -->
        </div>

        <div class="export-options">
            <button class="button button-primary" onclick="exportarMarkdown()">
                üìÑ Exportar Markdown
            </button>
            <button class="button button-primary" onclick="exportarJSON()">
                üíæ Exportar JSON
            </button>
            <button class="button button-secondary" onclick="copiarAlPortapapeles()">
                üìã Copiar al Portapapeles
            </button>
            <button class="button button-secondary" onclick="limpiarFormulario()">
                üóëÔ∏è Limpiar Formulario
            </button>
        </div>

        <div class="button-group" style="margin-top: 30px;">
            <button class="button button-secondary" onclick="previousTab('paso5')">‚Üê Anterior</button>
        </div>
    </div>
</div>

<!-- Modal para Selector de M√≥dulos -->
<div id="modal-modulos" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; overflow-y: auto;">
    <div style="max-width: 900px; margin: 50px auto; background: var(--hueso); border-radius: 20px; padding: 30px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 style="color: var(--menta-oscuro);">Selector de M√≥dulos</h2>
            <button class="button button-secondary" onclick="cerrarSelectorModulos()">‚úï Cerrar</button>
        </div>

        <div class="presupuesto-indicator" style="margin-bottom: 20px; font-size: 1.2em;">
            <span>PS Restantes:</span>
            <span id="ps-restantes-modal" style="font-size: 1.5em; font-weight: 700;">0</span>
        </div>

        <div id="categorias-modulos"></div>

        <div style="margin-top: 30px; text-align: center;">
            <button class="button button-primary" onclick="confirmarModulos()">
                ‚úì Confirmar Selecci√≥n
            </button>
        </div>
    </div>
</div><script>
        // Estado global de la aplicaci√≥n
        const appState = {
            habilidadActual: null,
            presupuestoActual: 0,
            modulosTemp: []
        };

        // Cat√°logo de m√≥dulos
        const catalogoModulos = {
            "A: Bonificadores Num√©ricos": [
                { nombre: "+1 a Defensa (condicional)", coste: 1 },
                { nombre: "+2 a Defensa (muy condicional)", coste: 2 },
                { nombre: "+1 a Armadura", coste: 1 },
                { nombre: "+2 a Salvaci√≥n espec√≠fica", coste: 2 },
                { nombre: "+3 Resistencia m√°xima", coste: 2 },
                { nombre: "+5 Resistencia m√°xima", coste: 4 },
                { nombre: "+1 al da√±o (condicional)", coste: 1 },
                { nombre: "+1 a ataque (condicional)", coste: 1 },
                { nombre: "Cambio de Tipo de da√±o (condicional)", coste: 2 },
                { nombre: "+3 metros movimiento", coste: 1 },
                { nombre: "+2 a Iniciativa", coste: 1 }
            ],
            "B: Ventajas y Condiciones": [
                { nombre: "Ventaja en categor√≠a espec√≠fica", coste: 2 },
                { nombre: "Bono +1 en categor√≠a espec√≠fica", coste: 1 },
                { nombre: "Ignorar terreno dif√≠cil (condicional)", coste: 2 },
                { nombre: "Inmunidad a estado menor", coste: 3 },
                { nombre: "Reducir coste o tiempo a la mitad", coste: 3 },
                { nombre: "Capacidad √∫nica menor", coste: 2 },
                { nombre: "Necesidades Reducidas", coste: 2 }
            ],
            "C: Acciones Activas": [
                { nombre: "Bono temporal simple", coste: 1 },
                { nombre: "Bono a aliado adyacente", coste: 2 },
                { nombre: "Curaci√≥n menor (3 puntos)", coste: 2 },
                { nombre: "Bono temporal mayor", coste: 4 },
                { nombre: "Curaci√≥n moderada (8 puntos)", coste: 3 },
                { nombre: "Eliminar estado alterado", coste: 4 },
                { nombre: "Ataque modificado (+3 da√±o)", coste: 4 },
                { nombre: "Imponer estado (ND 10-12)", coste: 4 },
                { nombre: "Efecto de √°rea peque√±o (3-6m)", coste: 5 },
                { nombre: "Estado mayor (ND 12-15)", coste: 5 },
                { nombre: "Ataques m√∫ltiples (2-3)", coste: 6 },
                { nombre: "Curaci√≥n mayor (8 puntos + efecto)", coste: 5 },
                { nombre: "Contraataque", coste: 3 },
                { nombre: "Interceptar ataque", coste: 4 },
                { nombre: "Evitar ca√≠da a 0", coste: 6 }
            ],
            "D: Habilidades Pasivas": [
                { nombre: "Beneficio situacional constante", coste: 2 },
                { nombre: "Reducir penalizador o requisito", coste: 2 },
                { nombre: "Bono +1 condicional permanente", coste: 2 },
                { nombre: "Capacidad √∫nica sin coste", coste: 3 },
                { nombre: "Modificar mec√°nica de juego", coste: 4 },
                { nombre: "Beneficio de recuperaci√≥n mejorada", coste: 3 },
                { nombre: "Inmunidad a categor√≠a de estado", coste: 5 },
                { nombre: "Reducci√≥n permanente de costes", coste: 5 },
                { nombre: "Doble beneficio pasivo", coste: 5 }
            ],
            "E: Efectos Cumbre (Solo Rango 3)": [
                { nombre: "√Årea grande + m√∫ltiples efectos", coste: 8 },
                { nombre: "Revivir desde 0 Resistencia", coste: 9 },
                { nombre: "Estado de transformaci√≥n", coste: 9 },
                { nombre: "M√∫ltiples estados sin salvaci√≥n", coste: 8 },
                { nombre: "Da√±o x2 + efecto adicional", coste: 8 },
                { nombre: "Inmunidad temporal a da√±o", coste: 7 },
                { nombre: "Cambio de reglas fundamental", coste: 9 }
            ]
        };

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            cargarDatosGuardados();
            actualizarEstadisticas();
        });

        // Funciones de navegaci√≥n
        function openTab(evt, tabName) {
            const tabContents = document.getElementsByClassName("tab-content");
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove("active");
            }

            const tabs = document.getElementsByClassName("tab");
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove("active");
            }

            document.getElementById(tabName).classList.add("active");
            evt.currentTarget.classList.add("active");

            if (tabName === 'resumen') {
                generarResumen();
            }

            window.scrollTo(0, 0);
        }

        function nextTab(tabName) {
            const tabs = document.querySelectorAll('.tab');
            const tabIndex = ['paso1', 'paso2', 'paso3', 'paso4', 'paso5', 'resumen'].indexOf(tabName);
            
            tabs.forEach(tab => tab.classList.remove('active'));
            tabs[tabIndex].classList.add('active');

            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');

            if (tabName === 'resumen') {
                generarResumen();
            }

            window.scrollTo(0, 0);
        }

        function previousTab(tabName) {
            nextTab(tabName);
        }

        // Validaciones
        function validarEnergias() {
            const tipoSenda = document.querySelector('input[name="tipo-senda"]:checked').value;
            const energiasSeleccionadas = document.querySelectorAll('#paso2 input[type="checkbox"]:checked').length;
            const errorDiv = document.getElementById('energia-error');

            const esperado = tipoSenda === 'especialista' ? 1 : 2;

            if (energiasSeleccionadas !== esperado) {
                errorDiv.style.display = 'block';
                errorDiv.textContent = `Debes seleccionar exactamente ${esperado} energ√≠a(s) para una Senda ${tipoSenda === 'especialista' ? 'Especialista' : 'H√≠brida'}.`;
            } else {
                errorDiv.style.display = 'none';
            }

            guardarDatos();
        }

        function actualizarTipoSenda() {
            // Desmarcar todas las energ√≠as
            document.querySelectorAll('#paso2 input[type="checkbox"]').forEach(cb => cb.checked = false);
            validarEnergias();
        }

        function validarConceptos() {
            const conceptosSeleccionados = document.querySelectorAll('#conceptos-lista input[type="checkbox"]:checked').length;
            const errorDiv = document.getElementById('conceptos-error');

            if (conceptosSeleccionados !== 3) {
                errorDiv.style.display = 'block';
            } else {
                errorDiv.style.display = 'none';
            }

            guardarDatos();
        }

        function validarEconomia(tipo) {
            const afinesSeleccionados = document.querySelectorAll('#afines-lista input[type="checkbox"]:checked').length;
            const ajenasSeleccionados = document.querySelectorAll('#ajenas-lista input[type="checkbox"]:checked').length;
            
            const afinesError = document.getElementById('afines-error');
            const ajenasError = document.getElementById('ajenas-error');

            if (afinesSeleccionados !== 3) {
                afinesError.style.display = 'block';
            } else {
                afinesError.style.display = 'none';
            }

            if (ajenasSeleccionados !== 2) {
                ajenasError.style.display = 'block';
            } else {
                ajenasError.style.display = 'none';
            }

            guardarDatos();
        }

        // Selector de m√≥dulos
        function abrirSelectorModulos(habilidad, presupuesto) {
            appState.habilidadActual = habilidad;
            appState.presupuestoActual = presupuesto;
            
            // Cargar m√≥dulos ya seleccionados
            const habilidadData = JSON.parse(localStorage.getItem('senda_habilidades') || '{}');
            appState.modulosTemp = habilidadData[habilidad]?.modulos || [];

            renderizarCatalogo();
            actualizarPSRestantes();

            document.getElementById('modal-modulos').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function cerrarSelectorModulos() {
            document.getElementById('modal-modulos').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function renderizarCatalogo() {
            const container = document.getElementById('categorias-modulos');
            container.innerHTML = '';

            const esRango3 = appState.habilidadActual?.includes('rango3');

            for (const [categoria, modulos] of Object.entries(catalogoModulos)) {
                // Ocultar Categor√≠a E si no es Rango 3
                if (categoria.includes('Cumbre') && !esRango3) continue;

                const categoriaDiv = document.createElement('div');
                categoriaDiv.className = 'modulo-categoria';

                const titulo = document.createElement('div');
                titulo.className = 'modulo-categoria-title';
                titulo.innerHTML = `${categoria} <span>‚ñº</span>`;
                titulo.onclick = function() {
                    const lista = this.nextElementSibling;
                    lista.classList.toggle('open');
                    this.querySelector('span').textContent = lista.classList.contains('open') ? '‚ñ≤' : '‚ñº';
                };

                const lista = document.createElement('div');
                lista.className = 'modulo-list';

                modulos.forEach((modulo, index) => {
                    const item = document.createElement('div');
                    item.className = 'modulo-item';
                    
                    const estaSeleccionado = appState.modulosTemp.some(m => 
                        m.nombre === modulo.nombre && m.categoria === categoria
                    );
                    
                    if (estaSeleccionado) {
                        item.classList.add('selected');
                    }

                    item.innerHTML = `
                        <span class="modulo-nombre">${modulo.nombre}</span>
                        <span class="modulo-coste">${modulo.coste} PS</span>
                    `;

                    item.onclick = function() {
                        toggleModulo(modulo, categoria, item);
                    };

                    lista.appendChild(item);
                });

                categoriaDiv.appendChild(titulo);
                categoriaDiv.appendChild(lista);
                container.appendChild(categoriaDiv);
            }
        }

        function toggleModulo(modulo, categoria, elemento) {
            const index = appState.modulosTemp.findIndex(m => 
                m.nombre === modulo.nombre && m.categoria === categoria
            );

            if (index >= 0) {
                // Quitar m√≥dulo
                appState.modulosTemp.splice(index, 1);
                elemento.classList.remove('selected');
            } else {
                // A√±adir m√≥dulo
                const costeTotal = calcularCosteTotal(appState.modulosTemp) + modulo.coste;
                if (costeTotal <= appState.presupuestoActual) {
                    appState.modulosTemp.push({ ...modulo, categoria });
                    elemento.classList.add('selected');
                } else {
                    alert('No tienes suficientes PS para este m√≥dulo.');
                    return;
                }
            }

            actualizarPSRestantes();
        }

        function calcularCosteTotal(modulos) {
            return modulos.reduce((sum, m) => sum + m.coste, 0);
        }

        function actualizarPSRestantes() {
            const usado = calcularCosteTotal(appState.modulosTemp);
            const restante = appState.presupuestoActual - usado;
            document.getElementById('ps-restantes-modal').textContent = restante;
        }

        function confirmarModulos() {
            const habilidadData = JSON.parse(localStorage.getItem('senda_habilidades') || '{}');
            habilidadData[appState.habilidadActual] = {
                ...habilidadData[appState.habilidadActual],
                modulos: appState.modulosTemp
            };
            localStorage.setItem('senda_habilidades', JSON.stringify(habilidadData));

            mostrarModulosSeleccionados(appState.habilidadActual);
            actualizarPresupuestoHabilidad(appState.habilidadActual);
            actualizarEstadisticas();
            cerrarSelectorModulos();
        }

        function mostrarModulosSeleccionados(habilidad) {
            const habilidadData = JSON.parse(localStorage.getItem('senda_habilidades') || '{}');
            const modulos = habilidadData[habilidad]?.modulos || [];

            const container = document.getElementById(`modulos-${habilidad}`);
            const lista = document.getElementById(`lista-modulos-${habilidad}`);

            if (modulos.length === 0) {
                container.style.display = 'none';
                return;
            }

            container.style.display = 'block';
            lista.innerHTML = '';

            modulos.forEach((modulo, index) => {
                const item = document.createElement('div');
                item.className = 'modulo-seleccionado';
                item.innerHTML = `
                    <span>${modulo.nombre} (${modulo.coste} PS)</span>
                    <button class="remove-modulo" onclick="eliminarModulo('${habilidad}', ${index})">‚úï</button>
                `;
                lista.appendChild(item);
            });
        }

        function eliminarModulo(habilidad, index) {
            const habilidadData = JSON.parse(localStorage.getItem('senda_habilidades') || '{}');
            habilidadData[habilidad].modulos.splice(index, 1);
            localStorage.setItem('senda_habilidades', JSON.stringify(habilidadData));

            mostrarModulosSeleccionados(habilidad);
            actualizarPresupuestoHabilidad(habilidad);
            actualizarEstadisticas();
        }

        function actualizarPresupuestoHabilidad(habilidad) {
            const habilidadData = JSON.parse(localStorage.getItem('senda_habilidades') || '{}');
            const modulos = habilidadData[habilidad]?.modulos || [];
            const usado = calcularCosteTotal(modulos);

            const presupuestos = {
                'inicial': 6,
                'rango1a': 4,
                'rango1b': 4,
                'rango2a': 6,
                'rango2b': 6,
                'rango3a': 9,
                'rango3b': 9
            };

            const presupuesto = presupuestos[habilidad];
            const indicador = document.getElementById(`presupuesto-${habilidad}`);
            indicador.querySelector('.presupuesto-usado').textContent = usado;

            indicador.classList.remove('presupuesto-ok', 'presupuesto-warning', 'presupuesto-error');

            if (usado > presupuesto) {
                indicador.classList.add('presupuesto-error');
            } else if (usado === presupuesto) {
                indicador.classList.add('presupuesto-ok');
            } else if (usado >= presupuesto * 0.7) {
                indicador.classList.add('presupuesto-warning');
            }
        }

        function actualizarEstadisticas() {
            const habilidadData = JSON.parse(localStorage.getItem('senda_habilidades') || '{}');
            const habilidades = ['inicial', 'rango1a', 'rango1b', 'rango2a', 'rango2b', 'rango3a', 'rango3b'];

            let totalUsado = 0;
            let habilidadesCompletas = 0;

            const presupuestos = {
                'inicial': 6,
                'rango1a': 4,
                'rango1b': 4,
                'rango2a': 6,
                'rango2b': 6,
                'rango3a': 9,
                'rango3b': 9
            };

            habilidades.forEach(hab => {
                const modulos = habilidadData[hab]?.modulos || [];
                const usado = calcularCosteTotal(modulos);
                totalUsado += usado;

                const nombre = document.getElementById(`nombre-${hab}`)?.value;
                if (nombre && modulos.length > 0 && usado <= presupuestos[hab]) {
                    habilidadesCompletas++;
                }

                mostrarModulosSeleccionados(hab);
                actualizarPresupuestoHabilidad(hab);
            });

            document.getElementById('total-ps-usado').textContent = totalUsado;
            document.getElementById('habilidades-completas').textContent = `${habilidadesCompletas}/7`;
        }

        // Guardar y cargar datos
        function guardarDatos() {
            const datos = {
                nombre: document.getElementById('nombre-senda')?.value || '',
                fantasia: document.getElementById('fantasia')?.value || '',
                equipo: document.getElementById('equipo')?.value || ''
            };

            localStorage.setItem('senda_datos', JSON.stringify(datos));
        }

        function guardarHabilidad(habilidad) {
            const habilidadData = JSON.parse(localStorage.getItem('senda_habilidades') || '{}');
            
            habilidadData[habilidad] = {
                ...habilidadData[habilidad],
                nombre: document.getElementById(`nombre-${habilidad}`)?.value || '',
                tipo: document.getElementById(`tipo-${habilidad}`)?.value || '',
                descripcion: document.getElementById(`desc-${habilidad}`)?.value || ''
            };

            localStorage.setItem('senda_habilidades', JSON.stringify(habilidadData));
        }

        function cargarDatosGuardados() {
            const datos = JSON.parse(localStorage.getItem('senda_datos') || '{}');
            
            if (datos.nombre) document.getElementById('nombre-senda').value = datos.nombre;
            if (datos.fantasia) document.getElementById('fantasia').value = datos.fantasia;
            if (datos.equipo) document.getElementById('equipo').value = datos.equipo;

            const habilidadData = JSON.parse(localStorage.getItem('senda_habilidades') || '{}');
            const habilidades = ['inicial', 'rango1a', 'rango1b', 'rango2a', 'rango2b', 'rango3a', 'rango3b'];

            habilidades.forEach(hab => {
                const data = habilidadData[hab];
                if (data) {
                    const nombreInput = document.getElementById(`nombre-${hab}`);
                    const tipoSelect = document.getElementById(`tipo-${hab}`);
                    const descTextarea = document.getElementById(`desc-${hab}`);

                    if (nombreInput && data.nombre) nombreInput.value = data.nombre;
                    if (tipoSelect && data.tipo) tipoSelect.value = data.tipo;
                    if (descTextarea && data.descripcion) descTextarea.value = data.descripcion;

                    mostrarModulosSeleccionados(hab);
                    actualizarPresupuestoHabilidad(hab);
                }
            });
        }// Generar resumen
        function generarResumen() {
            const validacion = validarSendaCompleta();
            const validacionDiv = document.getElementById('validacion-resumen');

            if (!validacion.valida) {
                validacionDiv.innerHTML = `
                    <div class="alert alert-error">
                        <strong>‚ö†Ô∏è La Senda est√° incompleta:</strong>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            ${validacion.errores.map(e => `<li>${e}</li>`).join('')}
                        </ul>
                    </div>
                `;
            } else {
                validacionDiv.innerHTML = `
                    <div class="alert alert-info" style="background: var(--exito); color: white; border-left-color: var(--menta-oscuro);">
                        <strong>‚úì ¬°Senda completa y lista para usar!</strong>
                    </div>
                `;
            }

            const resumenDiv = document.getElementById('resumen-completo');
            const datos = obtenerDatosCompletos();

            resumenDiv.innerHTML = `
                <h3>Informaci√≥n B√°sica</h3>
                <div class="resumen-item">
                    <div class="resumen-label">Nombre:</div>
                    <div>${datos.nombre || 'Sin nombre'}</div>
                </div>
                <div class="resumen-item">
                    <div class="resumen-label">Fantas√≠a:</div>
                    <div>${datos.fantasia || 'Sin descripci√≥n'}</div>
                </div>
                <div class="resumen-item">
                    <div class="resumen-label">Afinidad:</div>
                    <div>${datos.energias.join(', ') || 'Sin energ√≠as seleccionadas'}</div>
                </div>
                <div class="resumen-item">
                    <div class="resumen-label">Conceptos:</div>
                    <div>${datos.conceptos.join(', ') || 'Sin conceptos seleccionados'}</div>
                </div>
                <div class="resumen-item">
                    <div class="resumen-label">Equipo Inicial:</div>
                    <div>${datos.equipo || 'Sin equipo definido'}</div>
                </div>
                <div class="resumen-item">
                    <div class="resumen-label">Categor√≠as Afines:</div>
                    <div>${datos.afines.join(', ') || 'Sin categor√≠as afines'}</div>
                </div>
                <div class="resumen-item">
                    <div class="resumen-label">Categor√≠as Ajenas:</div>
                    <div>${datos.ajenas.join(', ') || 'Sin categor√≠as ajenas'}</div>
                </div>

                <h3 style="margin-top: 30px;">Habilidades</h3>
                ${generarResumenHabilidades(datos.habilidades)}
            `;
        }

        function generarResumenHabilidades(habilidades) {
            let html = '';
            const titulos = {
                'inicial': 'Habilidad Inicial (6 PS)',
                'rango1a': 'Rango 1A (4 PS)',
                'rango1b': 'Rango 1B (4 PS)',
                'rango2a': 'Rango 2A (6 PS)',
                'rango2b': 'Rango 2B (6 PS)',
                'rango3a': 'Rango 3A (9 PS)',
                'rango3b': 'Rango 3B (9 PS)'
            };

            for (const [key, hab] of Object.entries(habilidades)) {
                const costeTotal = calcularCosteTotal(hab.modulos);
                html += `
                    <div class="resumen-item">
                        <div class="resumen-label">${titulos[key]}: ${hab.nombre || 'Sin nombre'}</div>
                        <div>
                            ${hab.tipo ? `<strong>Tipo:</strong> ${hab.tipo}<br>` : ''}
                            ${hab.descripcion ? `<strong>Descripci√≥n:</strong> ${hab.descripcion}<br>` : ''}
                            <strong>M√≥dulos (${costeTotal} PS):</strong>
                            ${hab.modulos.length > 0 ? `
                                <ul style="margin-left: 20px; margin-top: 5px;">
                                    ${hab.modulos.map(m => `<li>${m.nombre} (${m.coste} PS)</li>`).join('')}
                                </ul>
                            ` : '<em>Sin m√≥dulos</em>'}
                        </div>
                    </div>
                `;
            }

            return html;
        }

        function validarSendaCompleta() {
            const errores = [];
            const datos = obtenerDatosCompletos();

            if (!datos.nombre) errores.push('Falta el nombre de la Senda');
            if (!datos.fantasia) errores.push('Falta la descripci√≥n de la fantas√≠a');
            if (datos.energias.length === 0) errores.push('No se han seleccionado Energ√≠as');
            if (datos.conceptos.length !== 3) errores.push('Deben seleccionarse exactamente 3 Conceptos');
            if (!datos.equipo) errores.push('Falta el equipo inicial');
            if (datos.afines.length !== 3) errores.push('Deben seleccionarse 3 categor√≠as Afines');
            if (datos.ajenas.length !== 2) errores.push('Deben seleccionarse 2 categor√≠as Ajenas');

            const presupuestos = {
                'inicial': 6,
                'rango1a': 4,
                'rango1b': 4,
                'rango2a': 6,
                'rango2b': 6,
                'rango3a': 9,
                'rango3b': 9
            };

            for (const [key, hab] of Object.entries(datos.habilidades)) {
                const coste = calcularCosteTotal(hab.modulos);
                if (!hab.nombre) errores.push(`La habilidad ${key} no tiene nombre`);
                if (hab.modulos.length === 0) errores.push(`La habilidad ${key} no tiene m√≥dulos`);
                if (coste > presupuestos[key]) errores.push(`La habilidad ${key} excede su presupuesto`);
            }

            return {
                valida: errores.length === 0,
                errores
            };
        }

        function obtenerDatosCompletos() {
            const datos = {
                nombre: document.getElementById('nombre-senda')?.value || '',
                fantasia: document.getElementById('fantasia')?.value || '',
                equipo: document.getElementById('equipo')?.value || '',
                tipoSenda: document.querySelector('input[name="tipo-senda"]:checked')?.value || 'especialista',
                energias: Array.from(document.querySelectorAll('#paso2 input[type="checkbox"]:checked')).map(cb => cb.value),
                conceptos: Array.from(document.querySelectorAll('#conceptos-lista input[type="checkbox"]:checked')).map(cb => cb.value),
                afines: Array.from(document.querySelectorAll('#afines-lista input[type="checkbox"]:checked')).map(cb => cb.value),
                ajenas: Array.from(document.querySelectorAll('#ajenas-lista input[type="checkbox"]:checked')).map(cb => cb.value),
                habilidades: {}
            };

            const habilidadData = JSON.parse(localStorage.getItem('senda_habilidades') || '{}');
            const habilidades = ['inicial', 'rango1a', 'rango1b', 'rango2a', 'rango2b', 'rango3a', 'rango3b'];

            habilidades.forEach(hab => {
                datos.habilidades[hab] = {
                    nombre: document.getElementById(`nombre-${hab}`)?.value || '',
                    tipo: document.getElementById(`tipo-${hab}`)?.value || '',
                    descripcion: document.getElementById(`desc-${hab}`)?.value || '',
                    modulos: habilidadData[hab]?.modulos || []
                };
            });

            return datos;
        }

        // Exportaci√≥n
        function exportarMarkdown() {
            const datos = obtenerDatosCompletos();
            const presupuestos = {
                'inicial': 6,
                'rango1a': 4,
                'rango1b': 4,
                'rango2a': 6,
                'rango2b': 6,
                'rango3a': 9,
                'rango3b': 9
            };

            let markdown = `# Senda ${datos.nombre}\n\n`;
            markdown += `## Concepto\n\n"${datos.fantasia}"\n\n`;
            markdown += `**Afinidad:** ${datos.energias.join(', ')}\n\n`;
            markdown += `**Conceptos:** ${datos.conceptos.join(', ')}\n\n`;
            markdown += `**Equipo Inicial:** ${datos.equipo}\n\n`;
            markdown += `### Costes Modificados\n\n`;
            markdown += `**Afines:** ${datos.afines.join(', ')}\n\n`;
            markdown += `**Ajenos:** ${datos.ajenas.join(', ')}\n\n`;
            markdown += `---\n\n`;

            const titulos = {
                'inicial': 'HABILIDAD INICIAL',
                'rango1a': 'RANGO 1A',
                'rango1b': 'RANGO 1B',
                'rango2a': 'RANGO 2A',
                'rango2b': 'RANGO 2B',
                'rango3a': 'RANGO 3A',
                'rango3b': 'RANGO 3B'
            };

            for (const [key, hab] of Object.entries(datos.habilidades)) {
                const coste = calcularCosteTotal(hab.modulos);
                markdown += `## ${titulos[key]} (${coste}/${presupuestos[key]} PS): ${hab.nombre}\n\n`;
                
                if (hab.descripcion) markdown += `${hab.descripcion}\n\n`;
                if (hab.tipo) markdown += `**Tipo:** ${hab.tipo}\n\n`;
                markdown += `**Componentes:**\n\n`;
                hab.modulos.forEach(m => {
                    markdown += `- ${m.nombre} (${m.coste} PS)\n`;
                });
                markdown += `\n**TOTAL:** ${coste} de ${presupuestos[key]} PS\n\n`;
                markdown += `---\n\n`;
            }

            descargarArchivo(markdown, `senda_${datos.nombre.replace(/\s/g, '_')}.md`, 'text/markdown');
        }

        function exportarJSON() {
            const datos = obtenerDatosCompletos();
            const json = JSON.stringify(datos, null, 2);
            descargarArchivo(json, `senda_${datos.nombre.replace(/\s/g, '_')}.json`, 'application/json');
        }

        function copiarAlPortapapeles() {
            const datos = obtenerDatosCompletos();
            const texto = `SENDA: ${datos.nombre}\n\nCONCEPTO: ${datos.fantasia}\n\nAFINIDAD: ${datos.energias.join(', ')}\n\nCONCEPTOS: ${datos.conceptos.join(', ')}\n\nEQUIPO: ${datos.equipo}\n\nAFINES: ${datos.afines.join(', ')}\n\nAJENOS: ${datos.ajenas.join(', ')}`;
            
            navigator.clipboard.writeText(texto).then(() => {
                alert('¬°Informaci√≥n b√°sica copiada al portapapeles!');
            }).catch(err => {
                console.error('Error al copiar:', err);
                // Fallback para navegadores que no soportan clipboard API
                const textarea = document.createElement('textarea');
                textarea.value = texto;
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    alert('¬°Informaci√≥n b√°sica copiada al portapapeles!');
                } catch (err) {
                    alert('No se pudo copiar al portapapeles. Por favor, copia manualmente.');
                }
                document.body.removeChild(textarea);
            });
        }

        function descargarArchivo(contenido, nombreArchivo, tipoMime) {
            const blob = new Blob([contenido], { type: tipoMime });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = nombreArchivo;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function limpiarFormulario() {
            if (confirm('¬øEst√°s seguro de que quieres limpiar todos los datos? Esta acci√≥n no se puede deshacer.')) {
                localStorage.removeItem('senda_datos');
                localStorage.removeItem('senda_habilidades');
                location.reload();
            }
        }
    </script>
</body>
</html>
```

